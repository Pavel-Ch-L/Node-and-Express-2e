# 12. Промышленная эксплуатация

	• app.set(name, value) // Установка переменной
	• app.get('env') // Чтение переменной окружения
	• echo $NODE_ENV // Значение переменной окружения в консоли
	• NODE_ENV=production node 00-logging.js // Измнение среды разработки в командной строке в 
			течении одного запуска программы
	• export NODE_ENV=development  // Измнение среды разработки в командной строке
	• NODE_ENV=production - включает кэширование представлений
	• npm i morgan - ПО для логгирования в режиме эксплуатации
	• Менеджеры процессов: 
			- Forever https://github.com/foreversd/forever
			- PM2 https://github.com/Unitech/pm2
	• npm -i -g forever
		forever start meadowlark.js
		forever restart meadowlark.js
		forever stop meadowlark.js
	• Вертикальное масштабирование - повышение мощности серверов
	• Горизонтальное масштабирование - увеличение числа серверов
	• При горизонтальном масштабированиии следует помнить о персистентности данных.
	• Node поддерживает кластеры приложений (независимый сервер для каждого ядра cpu).
	• Контекст выполнения определяется свойствами cluster.isMaster и cluster.isWorker
	• Express выполняя обработчики маршрутов помещает их  в блоки try catch
	• Не прехваченное исключение всегда останавливает сервер. Простейший механизм обработки
		отказа использовать кластер.
	• process.on('uncaughtException', err => { // Позволяет мягко остановить сервер.
	• Нужно всегда иметь механизм для записи исключений и оповещения о нем.
	• Сервисы для отслеживания и анализа ошибок:
		- Sentry http://sentry.io
		- Rollbar htpp://rollbar.com
		- Airbrake http://airbrake/io
		- New Relic http://newrelic/com
	• Для горизонтального масштабированиия с использованием нескольких серверов необходим 
		прокси-сервер (обратный прокси-сервер). NGINX HAProxy
	• app.enable('trust proxy')   // Сообщить Express, что используется пркси-сервер
		Это гарантирует, что req.ip, req.protocol, req.secure будут отображать подробности
		соединения между клиентом и прокси, а не клиентом и вашим приложением. В массиве
		req.ips будут находится исходный ip клиента, доменные имена и адреса всех промежуточных прокси.
	• Мониторы работоспособности:
		- UptimeRobot  http://uptimerobot.com
		- Pingdom
		- site24x7
	• npm i -g artillery  http://artillery.io  // Нагрузочное тестирование
	• npm i load-test  // Нагрузочное тестирование
	• "stress": "artillery quick --count 10 -n 50 http://localhost:3000/"  // 10 пользователей по 50 запросов