# 9. Cookie-файлы и сеансы

	• HTTP - протокол без сохранения состояния.
	• Идея cookie файла проста: сервер отправляет фрагмент информации, который храник браузер
		на протяжении настраиваемого промежутка времени (часто это просто ID).
	• Факты о cookie файлах:
		- Не скрыты от пользователя;
		- Пользователь может удалить или запретить cookie файлы;
		- Стандартные cookie файлы могут быть подделаны (можно использовать подписанные cookie);
		- Cookie файлы м.б. использованы для атак XSS (cross-site scripting). Вредный JS код меняющий
			содержимое cookie файла (необходимо использовать подписанные cookie);
		- Необходимо сводить использование cookie файлов к минимуму;
		- Сеансы предпочительнее cookie файлов.  
	• Секрет cookie файла представляет собой строку, извасную серверу и используемую для шифрования
		защищенных cookie файлов пред их отправкой клиенту.
	• npm i cookie-parser // Парсер 
		res.cookie('monster', 'nyam')
		res.cookie('signed_monster', 'nyam', {signed: true}) // Подписанные cookie файлы
	• Подписанные cookie файлы имеют приоритет над неподписанными.
	• req.cookies.monster
		req.signedCookies.signed_monster
	• res.clearCookie('monster') // Удаление cookie файла
	• Cookie опции - стр.131

	• Сеансы - удобный инструмент для сохранения состояния. Для сеанса требуется хранить что-нибудь 
		на клиенте для идентификации. Обычный способ для этого cookie файл, содержащий ID.
	• Кроме cookie файлов можно использовать локальное хранилище, которое имеет преимущество в большем
		объеме хранимой информации.
	• Существуют два способа реализации сеансов: хранить все в cookie файлах (сеансы на основе 
		cookie файлов) и хранить в cookie только ID, а все остальное на сервере.
	• npm i cookie-session // Для сеансов на основе cookie файлов. 
	• npm i express-session // Рекомендуемый способ
	• expressSession подключается после cookieParser.
	• Конфигурационный объект express-session (стр.134):
		app.use(expressSession({
			resave: false,
			saveUninitialized: false,
			secret: credentials.cookieSecret
		}))
	• Значения сессии хранятся в свойстве session объекта запроса
		req.session.userName
	• У объекта ответа нет свойства session.
	• delete req.session.userName // Удаление сессии

	•  Для реализации уведомлений можно использовать промежуточное ПО для передачи в контекст
		представления res.locals.flash данных из req.session.flash.
	• Поскольку уведомление перемещается из сеанса req.locals.flash в промежуточном ПО, прийдется 
		выполнять перенаправление, чтобы оно отобразилось. Если нужно выполнять отображение без 
		перенаправления необходимо использовать res.locals.flash без req.session.flash.
	
	• Чаще всего сеансы используются для предоставления информации об аутентификации пользователя.